{"expireTime":9007200904342772000,"key":"transformer-remark-markdown-html-22c1c67342bfb6453b0f46b2b272ea3e--","val":"<h1>Postgresql Cheat Sheet</h1>\n<p>PostgreSQL commands</p>\n<hr>\n<h4><a href=\"http://medium.com/codex\" class=\"markup--anchor markup--h4-anchor\">CODEX</a></h4>\n<h3>PostgreSQL Cheat Sheet</h3>\n<h4><strong>Each table is made up of rows and columns. If you think of a table as a grid, the column go from left to right across the grid and each entry of data is listed down as a row.</strong></h4>\n<figure><img src=\"https://cdn-images-1.medium.com/max/800/0*ZLWhY1d1jdboZh_s.png\" class=\"graf-image\" /></figure><a href=\"https://bryanguner.medium.com/a-list-of-all-of-my-articles-to-link-to-future-posts-1f6f88ebdf5b\" class=\"markup--anchor markup--mixtapeEmbed-anchor\" title=\"https://bryanguner.medium.com/a-list-of-all-of-my-articles-to-link-to-future-posts-1f6f88ebdf5b\"><strong>ALLOFMYOTHERARTICLES</strong><br />\nbryanguner.medium.com</a><a href=\"https://bryanguner.medium.com/a-list-of-all-of-my-articles-to-link-to-future-posts-1f6f88ebdf5b\" class=\"js-mixtapeImage mixtapeImage mixtapeImage--empty u-ignoreBlock\"></a>\n<p>Each row in a relational is uniquely identified by a primary key. This can be by one or more sets of column values. In most scenarios it is a single column, such as employeeID.</p>\n<p>Every relational table has one primary key. Its purpose is to uniquely identify each row in the database. No two rows can have the same primary key value. The practical result of this is that you can select every single row by just knowing its primary key.</p>\n<p>SQL Server UNIQUE constraints allow you to ensure that the data stored in a column, or a group of columns, is unique among the rows in a table.</p>\n<p>Although both UNIQUE and <a href=\"https://www.sqlservertutorial.net/sql-server-basics/sql-server-primary-key/\" class=\"markup--anchor markup--p-anchor\">PRIMARY KEY</a> constraints enforce the uniqueness of data, you should use the UNIQUE constraint instead of PRIMARY KEY constraint when you want to enforce the uniqueness of a column, or a group of columns, that are not the primary key columns.</p>\n<p>Different from PRIMARY KEY constraints, UNIQUE constraints allow NULL. Moreover, UNIQUE constraints treat the NULL as a regular value, therefore, it only allows one NULL per column.</p>\n<figure><img src=\"https://cdn-images-1.medium.com/max/800/1*kgzq5NoL5ejBGvuZ4qLDaQ.png\" class=\"graf-image\" /></figure><figure><img src=\"https://cdn-images-1.medium.com/max/800/1*hr8DccnpiR2Uj5UI3iLsOQ.png\" class=\"graf-image\" /></figure><figure><img src=\"https://cdn-images-1.medium.com/max/800/1*RiWJpwpVMdge3Sqofn3srA.png\" class=\"graf-image\" /></figure><figure><img src=\"https://cdn-images-1.medium.com/max/800/1*GN5aSwENOvntpfk90rHYFg.png\" class=\"graf-image\" /></figure>Create a new <a href=\"https://www.postgresqltutorial.com/postgresql-roles/\" class=\"markup--anchor markup--p-anchor\">role</a>:\n<pre><code>CREATE ROLE role_name;\n</code></pre>\n<p>Create a new role with a <code>username</code> and <code>password</code>:</p>\n<pre><code>CREATE ROLE username NOINHERIT LOGIN PASSWORD password;\n</code></pre>\n<p>Change role for the current session to the <code>new_role</code>:</p>\n<pre><code>SET ROLE new_role;\n</code></pre>\n<p>Allow <code>role_1</code> to set its role as <code>role_2:</code></p>\n<pre><code>GRANT role_2 TO role_1;\n</code></pre>\n<h3>Managing databases</h3>\n<p><a href=\"https://www.postgresqltutorial.com/postgresql-create-database/\" class=\"markup--anchor markup--p-anchor\">Create a new database</a>:</p>\n<pre><code>CREATE DATABASE [IF NOT EXISTS] db_name;\n</code></pre>\n<p><a href=\"https://www.postgresqltutorial.com/postgresql-drop-database/\" class=\"markup--anchor markup--p-anchor\">Delete a database permanently</a>:</p>\n<pre><code>DROP DATABASE [IF EXISTS] db_name;\n</code></pre>\n<h3>Managing tables</h3>\n<p><a href=\"https://www.postgresqltutorial.com/postgresql-create-table/\" class=\"markup--anchor markup--p-anchor\">Create a new table</a> or a <a href=\"https://www.postgresqltutorial.com/postgresql-temporary-table/\" class=\"markup--anchor markup--p-anchor\">temporary table</a></p>\n<pre><code>CREATE [TEMP] TABLE [IF NOT EXISTS] table_name(\n       pk SERIAL PRIMARY KEY,\n   c1 type(size) NOT NULL,\n   c2 type(size) NULL,\n   ...\n);\n</code></pre>\n<p><a href=\"https://www.postgresqltutorial.com/postgresql-add-column/\" class=\"markup--anchor markup--p-anchor\">Add a new column</a> to a table:</p>\n<pre><code>ALTER TABLE table_name ADD COLUMN new_column_name TYPE;\n</code></pre>\n<p><a href=\"https://www.postgresqltutorial.com/postgresql-drop-column/\" class=\"markup--anchor markup--p-anchor\">Drop a column</a> in a table:</p>\n<pre><code>ALTER TABLE table_name DROP COLUMN column_name;\n</code></pre>\n<p><a href=\"https://www.postgresqltutorial.com/postgresql-rename-column/\" class=\"markup--anchor markup--p-anchor\">Rename a column</a>:</p>\n<pre><code>ALTER TABLE table_name RENAME column_name TO new_column_name;\n</code></pre>\n<p>Set or remove a default value for a column:</p>\n<pre><code>ALTER TABLE table_name ALTER COLUMN [SET DEFAULT value | DROP DEFAULT]\n</code></pre>\n<p>Add a <a href=\"https://www.postgresqltutorial.com/postgresql-primary-key/\" class=\"markup--anchor markup--p-anchor\">primary key</a> to a table.</p>\n<pre><code>ALTER TABLE table_name ADD PRIMARY KEY (column,...);\n</code></pre>\n<p>Remove the primary key from a table.</p>\n<pre><code>ALTER TABLE table_name\nDROP CONSTRAINT primary_key_constraint_name;\n</code></pre>\n<p><a href=\"https://www.postgresqltutorial.com/postgresql-rename-table/\" class=\"markup--anchor markup--p-anchor\">Rename a table</a>.</p>\n<pre><code>ALTER TABLE table_name RENAME TO new_table_name;\n</code></pre>\n<p><a href=\"https://www.postgresqltutorial.com/postgresql-drop-table/\" class=\"markup--anchor markup--p-anchor\">Drop a table</a> and its dependent objects:</p>\n<pre><code>DROP TABLE [IF EXISTS] table_name CASCADE;\n</code></pre>\n<h3>Managing views</h3>\n<p><a href=\"https://www.postgresqltutorial.com/managing-postgresql-views/\" class=\"markup--anchor markup--p-anchor\">Create a view</a>:</p>\n<pre><code>CREATE OR REPLACE view_name AS\nquery;\n</code></pre>\n<p><a href=\"https://www.postgresqltutorial.com/postgresql-recursive-view/\" class=\"markup--anchor markup--p-anchor\">Create a recursive view</a>:</p>\n<pre><code>CREATE RECURSIVE VIEW view_name(column_list) AS\nSELECT column_list;\n</code></pre>\n<p><a href=\"https://www.postgresqltutorial.com/postgresql-materialized-views/\" class=\"markup--anchor markup--p-anchor\">Create a materialized view</a>:</p>\n<pre><code>CREATE MATERIALIZED VIEW view_name\nAS\nquery\nWITH [NO] DATA;\n</code></pre>\n<p>Refresh a materialized view:</p>\n<pre><code>REFRESH MATERIALIZED VIEW CONCURRENTLY view_name;\n</code></pre>\n<p>Drop a view:</p>\n<pre><code>DROP VIEW [ IF EXISTS ] view_name;\n</code></pre>\n<p>Drop a materialized view:</p>\n<pre><code>DROP MATERIALIZED VIEW view_name;\n</code></pre>\n<p>Rename a view:</p>\n<pre><code>ALTER VIEW view_name RENAME TO new_name;\n</code></pre>\n<h3>Managing indexes</h3>\n<p>Creating an index with the specified name on a table</p>\n<pre><code>CREATE [UNIQUE] INDEX index_name\nON table (column,...)\n</code></pre>\n<p>Removing a specified index from a table</p>\n<pre><code>DROP INDEX index_name;\n</code></pre>\n<h3>Querying data from tables</h3>\n<p>Query all data from a table:</p>\n<pre><code>SELECT * FROM table_name;\n</code></pre>\n<p>Query data from specified columns of all rows in a table:</p>\n<pre><code>SELECT column_list\nFROM table;\n</code></pre>\n<p>Query data and select only unique rows:</p>\n<pre><code>SELECT DISTINCT (column)\nFROM table;\n</code></pre>\n<p>Query data from a table with a filter:</p>\n<pre><code>SELECT *\nFROM table\nWHERE condition;\n</code></pre>\n<p>Assign an <a href=\"https://www.postgresqltutorial.com/postgresql-alias/\" class=\"markup--anchor markup--p-anchor\">alias</a> to a column in the result set:</p>\n<pre><code>SELECT column_1 AS new_column_1, ...\nFROM table;\n</code></pre>\n<p>Query data using the <code>LIKE</code> operator:</p>\n<pre><code>SELECT * FROM table_name\nWHERE column LIKE '%value%'\n</code></pre>\n<p>Query data using the <code>BETWEEN</code>operator:</p>\n<pre><code>SELECT * FROM table_name\nWHERE column BETWEEN low AND high;\n</code></pre>\n<p>Query data using the <code>IN</code>operator:</p>\n<pre><code>SELECT * FROM table_name\nWHERE column IN (value1, value2,...);\n</code></pre>\n<p>Constrain the returned rows with the <code>LIMIT</code> clause:</p>\n<pre><code>SELECT * FROM table_name\nLIMIT limit OFFSET offset\nORDER BY column_name;\n</code></pre>\n<p>Query data from multiple using the <a href=\"https://www.postgresqltutorial.com/postgresql-inner-join/\" class=\"markup--anchor markup--p-anchor\">inner join</a>, <a href=\"https://www.postgresqltutorial.com/postgresql-left-join/\" class=\"markup--anchor markup--p-anchor\">left join</a>, <a href=\"https://www.postgresqltutorial.com/postgresql-full-outer-join/\" class=\"markup--anchor markup--p-anchor\">full outer join</a>, <a href=\"https://www.postgresqltutorial.com/postgresql-cross-join/\" class=\"markup--anchor markup--p-anchor\">cross join</a> and <a href=\"https://www.postgresqltutorial.com/postgresql-natural-join/\" class=\"markup--anchor markup--p-anchor\">natural join</a>:</p>\n<pre><code>SELECT *\nFROM table1\nINNER JOIN table2 ON conditions\nSELECT *\nFROM table1\nLEFT JOIN table2 ON conditions\nSELECT *\nFROM table1\nFULL OUTER JOIN table2 ON conditions\nSELECT *\nFROM table1\nCROSS JOIN table2;\nSELECT *\nFROM table1\nNATURAL JOIN table2;\n</code></pre>\n<p>Return the number of rows of a table.</p>\n<pre><code>SELECT COUNT (*)\nFROM table_name;\n</code></pre>\n<p>Sort rows in ascending or descending order:</p>\n<pre><code>SELECT select_list\nFROM table\nORDER BY column ASC [DESC], column2 ASC [DESC],...;\n</code></pre>\n<p>Group rows using <code>GROUP BY</code> clause.</p>\n<pre><code>SELECT *\nFROM table\nGROUP BY column_1, column_2, ...;\n</code></pre>\n<p>Filter groups using the <code>HAVING</code> clause.</p>\n<pre><code>SELECT *\nFROM table\nGROUP BY column_1\nHAVING condition;\n</code></pre>\n<h3>Set operations</h3>\n<p>Combine the result set of two or more queries with <code>UNION</code> operator:</p>\n<pre><code>SELECT * FROM table1\nUNION\nSELECT * FROM table2;\n</code></pre>\n<p>Minus a result set using <code>EXCEPT</code> operator:</p>\n<pre><code>SELECT * FROM table1\nEXCEPT\nSELECT * FROM table2;\n</code></pre>\n<p>Get intersection of the result sets of two queries:</p>\n<pre><code>SELECT * FROM table1\nINTERSECT\nSELECT * FROM table2;\n</code></pre>\n<h3>Modifying data</h3>\n<p><a href=\"https://www.postgresqltutorial.com/postgresql-insert/\" class=\"markup--anchor markup--p-anchor\">Insert a new row into a table</a>:</p>\n<pre><code>INSERT INTO table(column1,column2,...)\nVALUES(value_1,value_2,...);\n</code></pre>\n<p>Insert multiple rows into a table:</p>\n<pre><code>INSERT INTO table_name(column1,column2,...)\nVALUES(value_1,value_2,...),\n      (value_1,value_2,...),\n      (value_1,value_2,...)...\n</code></pre>\n<p><a href=\"https://www.postgresqltutorial.com/postgresql-update/\" class=\"markup--anchor markup--p-anchor\">Update</a> data for all rows:</p>\n<pre><code>UPDATE table_name\nSET column_1 = value_1,\n    ...;\n</code></pre>\n<p>Update data for a set of rows specified by a condition in the <code>WHERE</code> clause.</p>\n<pre><code>UPDATE table\nSET column_1 = value_1,\n    ...\nWHERE condition;\n</code></pre>\n<p><a href=\"https://www.postgresqltutorial.com/postgresql-delete/\" class=\"markup--anchor markup--p-anchor\">Delete all rows</a> of a table:</p>\n<pre><code>DELETE FROM table_name;\n</code></pre>\n<p>Delete specific rows based on a condition:</p>\n<pre><code>DELETE FROM table_name\nWHERE condition;\n</code></pre>\n<h3>Performance</h3>\n<p>Show the query plan for a query:</p>\n<pre><code>EXPLAIN query;\n</code></pre>\n<p>Show and execute the query plan for a query:</p>\n<pre><code>EXPLAIN ANALYZE query;\n</code></pre>\n<p>Collect statistics:</p>\n<pre><code>ANALYZE table_name;\n</code></pre>\n<hr>\n<h3>Postgres &#x26; JSON:</h3>\n<h3>Creating the DB and the Table</h3>\n<pre><code>DROP DATABASE IF EXISTS books_db;\nCREATE DATABASE books_db WITH ENCODING='UTF8' TEMPLATE template0;\n\nDROP TABLE IF EXISTS books;\n\nCREATE TABLE books (\n  id SERIAL PRIMARY KEY,\n  client VARCHAR NOT NULL,\n  data JSONb NOT NULL\n);\n</code></pre>\n<h3>Populating the DB</h3>\n<pre><code>INSERT INTO books(client, data) values( 'Joe', '{ \"title\": \"Siddhartha\", \"author\": { \"first_name\": \"Herman\", \"last_name\": \"Hesse\" } }' ); INSERT INTO books(client, data) values('Jenny', '{ \"title\": \"Bryan Guner\", \"author\": { \"first_name\": \"Jack\", \"last_name\": \"Kerouac\" } }'); INSERT INTO books(client, data) values('Jenny', '{ \"title\": \"100 años de soledad\", \"author\": { \"first_name\": \"Gabo\", \"last_name\": \"Marquéz\" } }');\n</code></pre>\n<p>Lets see everything inside the table books:</p>\n<pre><code>SELECT * FROM books;\n</code></pre>\n<p>Output:</p>\n<figure><img src=\"https://cdn-images-1.medium.com/max/800/0*GOQQ0qNGak2yIrtQ\" class=\"graf-image\" /></figure>### `->` operator returns values out of JSON columns\n<p>Selecting 1 column:</p>\n<pre><code>SELECT client,\n    data->'title' AS title\n    FROM books;\n</code></pre>\n<p>Output:</p>\n<figure><img src=\"https://cdn-images-1.medium.com/max/800/0*OIVYOfYcbVh65Mt5\" class=\"graf-image\" /></figure>Selecting 2 columns:\n<pre><code>SELECT client,\n   data->'title' AS title, data->'author' AS author\n   FROM books;\n</code></pre>\n<p>Output:</p>\n<figure><img src=\"https://cdn-images-1.medium.com/max/800/0*fEzPkSY8yGexKOk4\" class=\"graf-image\" /></figure>### `->` vs `->>`\n<p>The <code>-></code> operator returns the original JSON type (which might be an object), whereas <code>->></code> returns text.</p>\n<h3>Return NESTED objects</h3>\n<p>You can use the <code>-></code> to return a nested object and thus chain the operators:</p>\n<pre><code>SELECT client,\n   data->'author'->'last_name' AS author\n   FROM books;\n</code></pre>\n<p>Output:</p>\n<figure><img src=\"https://cdn-images-1.medium.com/max/800/0*lwy8bR7igaroMXeb\" class=\"graf-image\" /></figure>### Filtering\n<p>Select rows based on a value inside your JSON:</p>\n<pre><code>SELECT\n client,\n data->'title' AS title\n FROM books\n  WHERE data->'title' = '\"Bryan Guner\"';\n</code></pre>\n<p>Notice WHERE uses <code>-></code> so we must compare to JSON <code>'\"Bryan Guner\"'</code></p>\n<p>Or we could use <code>->></code> and compare to <code>'Bryan Guner'</code></p>\n<p>Output:</p>\n<figure><img src=\"https://cdn-images-1.medium.com/max/800/0*poASndLoU71qlXqE\" class=\"graf-image\" /></figure>### Nested filtering\n<p>Find rows based on the value of a nested JSON object:</p>\n<pre><code>SELECT\n client,\n data->'title' AS title\n FROM books\n  WHERE data->'author'->>'last_name' = 'Kerouac';\n</code></pre>\n<p>Output:</p>\n<figure><img src=\"https://cdn-images-1.medium.com/max/800/0*R1kOhDK19ntdUYkq\" class=\"graf-image\" /></figure>### A real world example\n<pre><code>CREATE TABLE events (\n  name varchar(200),\n  visitor_id varchar(200),\n  properties json,\n  browser json\n);\n</code></pre>\n<p>We're going to store events in this table, like pageviews. Each event has properties, which could be anything (e.g. current page) and also sends information about the browser (like OS, screen resolution, etc). Both of these are completely free form and could change over time (as we think of extra stuff to track).</p>\n<pre><code>INSERT INTO events VALUES (\n  'pageview', '1',\n  '{ \"page\": \"/\" }',\n  '{ \"name\": \"Chrome\", \"os\": \"Mac\", \"resolution\": { \"x\": 1440, \"y\": 900 } }'\n);\nINSERT INTO events VALUES (\n  'pageview', '2',\n  '{ \"page\": \"/\" }',\n  '{ \"name\": \"Firefox\", \"os\": \"Windows\", \"resolution\": { \"x\": 1920, \"y\": 1200 } }'\n);\nINSERT INTO events VALUES (\n  'pageview', '1',\n  '{ \"page\": \"/account\" }',\n  '{ \"name\": \"Chrome\", \"os\": \"Mac\", \"resolution\": { \"x\": 1440, \"y\": 900 } }'\n);\nINSERT INTO events VALUES (\n  'purchase', '5',\n  '{ \"amount\": 10 }',\n  '{ \"name\": \"Firefox\", \"os\": \"Windows\", \"resolution\": { \"x\": 1024, \"y\": 768 } }'\n);\nINSERT INTO events VALUES (\n  'purchase', '15',\n  '{ \"amount\": 200 }',\n  '{ \"name\": \"Firefox\", \"os\": \"Windows\", \"resolution\": { \"x\": 1280, \"y\": 800 } }'\n);\nINSERT INTO events VALUES (\n  'purchase', '15',\n  '{ \"amount\": 500 }',\n  '{ \"name\": \"Firefox\", \"os\": \"Windows\", \"resolution\": { \"x\": 1280, \"y\": 800 } }'\n);\n</code></pre>\n<p>Now lets select everything:</p>\n<pre><code>SELECT * FROM events;\n</code></pre>\n<p>Output:</p>\n<figure><img src=\"https://cdn-images-1.medium.com/max/800/0*ZPHfB4FxjSIlAVxL\" class=\"graf-image\" /></figure>### JSON operators + PostgreSQL aggregate functions\n<p>Using the JSON operators, combined with traditional PostgreSQL aggregate functions, we can pull out whatever we want. You have the full might of an RDBMS at your disposal.</p>\n<ul>\n<li><span id=\"4ffd\">Lets see browser usage:</span></li>\n<li><span id=\"261c\"><code>SELECT browser->>'name' AS browser, count(browser) FROM events GROUP BY browser->>'name';</code></span></li>\n</ul>\n<p>Output:</p>\n<figure><img src=\"https://cdn-images-1.medium.com/max/800/0*4lEv2DgUk33FeUgo\" class=\"graf-image\" /></figure>- <span id=\"946c\">Total revenue per visitor:</span>\n<p><code>SELECT visitor_id, SUM(CAST(properties->>'amount' AS integer)) AS total FROM events WHERE CAST(properties->>'amount' AS integer) > 0 GROUP BY visitor_id;</code></p>\n<p>Output:</p>\n<figure><img src=\"https://cdn-images-1.medium.com/max/800/0*HxOS3CgwXBJ6A2FP\" class=\"graf-image\" /></figure>- <span id=\"9850\">Average screen resolution</span>\n- <span id=\"132f\">`SELECT AVG(CAST(browser->'resolution'->>'x' AS integer)) AS width, AVG(CAST(browser->'resolution'->>'y' AS integer)) AS height FROM events;`</span>\n<p>Output:</p>\n<figure><img src=\"https://cdn-images-1.medium.com/max/800/0*iyv4Iv4Rc8M8mwt1\" class=\"graf-image\" /></figure>#### If you found this guide helpful feel free to checkout my github/gists where I host similar content:\n<p><a href=\"https://gist.github.com/bgoonz\" class=\"markup--anchor markup--p-anchor\">bgoonz's gists · GitHub</a></p>\n<p><a href=\"https://github.com/bgoonz\" class=\"markup--anchor markup--mixtapeEmbed-anchor\" title=\"https://github.com/bgoonz\"><strong>bgoonz — Overview</strong><br />\n<em>Web Developer, Electrical Engineer JavaScript | CSS | Bootstrap | Python | React | Node.js | Express | Sequelize…</em>github.com</a><a href=\"https://github.com/bgoonz\" class=\"js-mixtapeImage mixtapeImage u-ignoreBlock\"></a></p>\n<p>Or Checkout my personal Resource Site:</p>\n<p><a href=\"https://goofy-euclid-1cd736.netlify.app/\" class=\"markup--anchor markup--mixtapeEmbed-anchor\" title=\"https://goofy-euclid-1cd736.netlify.app/\"><strong>a/A-Student-Resources</strong><br />\n<em>Edit description</em>goofy-euclid-1cd736.netlify.app</a><a href=\"https://goofy-euclid-1cd736.netlify.app/\" class=\"js-mixtapeImage mixtapeImage u-ignoreBlock\"></a></p>\n<h3>If you found this guide helpful feel free to checkout my GitHub/gists where I host similar content:</h3>\n<p><a href=\"https://gist.github.com/bgoonz\" class=\"markup--anchor markup--mixtapeEmbed-anchor\" title=\"https://gist.github.com/bgoonz\"><strong>bgoonz's gists</strong><br />\n<em>Instantly share code, notes, and snippets. Web Developer, Electrical Engineer JavaScript | CSS | Bootstrap | Python |…</em>gist.github.com</a><a href=\"https://gist.github.com/bgoonz\" class=\"js-mixtapeImage mixtapeImage u-ignoreBlock\"></a></p>\n<p><a href=\"https://github.com/bgoonz\" class=\"markup--anchor markup--mixtapeEmbed-anchor\" title=\"https://github.com/bgoonz\"><strong>bgoonz — Overview</strong><br />\n<em>Web Developer, Electrical Engineer JavaScript | CSS | Bootstrap | Python | React | Node.js | Express | Sequelize…</em>github.com</a><a href=\"https://github.com/bgoonz\" class=\"js-mixtapeImage mixtapeImage u-ignoreBlock\"></a></p>\n<h3>Or Checkout my personal Resource Site:</h3>"}